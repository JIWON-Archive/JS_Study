'use strict';

// Promise is a JavaScript Object for asynchronous operation.
// ë¹„ë™ê¸°ì ì¸ ê²ƒì„ ìˆ˜í–‰í•  ë•Œ ì½œë°±í•¨ìˆ˜ ëŒ€ì‹ ì— ìœ ìš©í•˜ê²Œ ì“¸ ìˆ˜ ìžˆë‹¤.
// state : 1. operationì„ ìˆ˜í–‰ ì¤‘ pending 
// 2. operationì„ ëë‚¸ ìƒíƒœ fulfilled(ì„±ê³µ) or reject(íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ì— ë¬¸ì œê°€ ìžˆëŠ” ê²½ìš°)
// Producer vs Consumer

// 1. Producer(ì •ë³´ë¥¼ ì œê³µ)
// executor ë¼ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ì „ë‹¬
// resolve : ê¸°ëŠ¥ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•´ì„œ ë§ˆì§€ë§‰ì— ìµœì¢… ë°ì´í„°ë¥¼ ì „ë‹¬
// reject : ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ë‹¤ê°€ ì¤‘ê°„ì— ë¬¸ì œê°€ ìƒê¸°ë©´ í˜¸ì¶œ
// when new Promise is created, the executor runs automatically.
const promise = new Promise((resolve, reject) => {
    // doing some heavy work(network, read files) 
    // ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ê±°ë‚˜ íŒŒì¼ì„ ë¬´ì–¸ê°€ í° ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ê³¼ì • ì‹œê°„ì´ ê½¤ ê±¸ë¦¼
    // ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©´ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” ë™ì•ˆ ë‹¤ìŒ ë¼ì¸ì˜ ì½”ë“œê°€ ì‹¤í–‰ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— 
    // ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì¼ì€ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.

    console.log('doing someting...')
    // í”„ë¡œë¯¸ìŠ¤ë¥¼ ë§Œë“œëŠ” ìˆœê°„ ìš°ë¦¬ê°€ ì „ë‹¬í•œ â—executorë¼ëŠ” ì½œë°±í•¨ìˆ˜ê°€ ë°”ë¡œ ì „ë‹¬ëœë‹¤.(ìžë™ ì‹¤í–‰)
    // ì¦‰, í”„ë¡œë¯¸ìŠ¤ ì•ˆì— ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ì „ë‹¬í•˜ëŠ” ì½”ë“œë¥¼ ìž‘ì„±í–ˆë‹¤ë©´ í”„ë¡œë¯¸ìŠ¤ê°€ ë§Œë“¤ì–´ì§€ëŠ” ìˆœê°„ ë°”ë¡œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ìˆ˜í–‰
    // ðŸ‘€ ì£¼ì˜ : ë§Œì•½ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì‚¬ìš©ìžê°€ ìš”êµ¬í–ˆì„ ë•Œë§Œ í•´ì•¼í•˜ëŠ” ê²½ìš°ë¼ë©´(ì¦‰ ì‚¬ìš©ìžê°€ ë²„íŠ¼ì„ ëˆŒë €ì„ë•Œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­í•´ì•¼í•˜ëŠ” ê²½ìš°)
    // ì‚¬ìš©ìžê°€ ìš”êµ¬í•˜ì§€ ì•Šì€ ë¶ˆí•„ìš”í•œ í†µì‹ ì´ ì¼ì–´ë‚ ìˆ˜ ìžˆë‹¤.

    setTimeout(()=> {
        resolve('hueka');
        // reject(new Error('no network')); // Error ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ”ê±¸ ë‚˜íƒ€ë‚¸(ì´ìœ ë¥¼ ìž˜ìž‘ì„±í•´ì•¼í•œë‹¤.) JS ì˜¤ë¸Œì íŠ¸
    }, 2000);
});

// 2. Consumer(ì •ë³´ë¥¼ ì†Œë¹„) : then, catch, finally
// í”„ë¡œë¯¸ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ì–´ì„œ ë§ˆì§€ë§‰ì— ìµœì¢…ì ìœ¼ë¡œ resolveë¼ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ì „ë‹¬í•œ ê°’ì´ valueì˜ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë˜ì–´ ë“¤ì–´ì˜¨ë‹¤. 
// thenì„ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ ë‹¤ì‹œ Promiseê°€ ë¦¬í„´ë˜ê³  ë¦¬í„´ëœ Promiseì— catch ë“±ë¡ : í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹
promise
.then(value => { // ê°’ì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ëœë‹¤ë©´ then(ê·¸ëŸ¬ë©´) ê°’ì„ ë°›ì•„ì˜¨ë‹¤. ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” ì½œë°±í•¨ìˆ˜ ìž‘ì„±í•´ì£¼ë©´ ëœë‹¤!!
    console.log(value); // resolve ì½œë°±í•¨ìˆ˜ì—ì„œ ì „ë‹¬ëœ huekaë¼ëŠ” ê°’ì´ ë“¤ì–´ì˜¨ë‹¤.
})
.catch(error => { // ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ì²˜ë¦¬í•  ê²ƒì¸ì§€ ì½œë°±í•¨ìˆ˜ ë“±ë¡
    console.log(error);
})
.finally(() => {
    console.log('finally');
}); //  finallyëŠ” ì„±ê³µ ì‹¤íŒ¨ ìƒê´€ì—†ì´ ë¬´ì¡°ê±´ ë§ˆì§€ë§‰ì— í˜¸ì¶œ


// í”„ë¡œë¯¸ìŠ¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ ë•Œ ìš°ë¦¬ê°€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ê³  ì‹¶ì€ ê·¸ëŸ° ê¸°ëŠ¥ë“¤ì˜ ì½”ë“œë¥¼ ì—¬ê¸°ì— ìž‘ì„±í•˜ê³ 
// ì„±ê³µ resolve í˜¸ì¶œ / ì‹¤íŒ¨ reject(ì—ëŸ¬) ì „ë‹¬
// then ì„±ê³µí•œ ê°’ catchëŠ” ì‹¤íŒ¨í•œ ì—ëŸ¬ë¥¼ ë°›ì•„ì™€ì„œ ìš°ë¦¬ê°€ ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬

// 3. Promise chaining
const fetchNumber = new Promise((resolve, reject) => {
    setTimeout(() => resolve(1), 1000); // 1ì´ˆ í›„ 1ì„ ì „ë‹¬
});

fetchNumber
.then(num => num * 2) // 1 * 2 = 2
.then(num => num * 3) // 2 * 3 = 6
.then(num => {
    return new Promise((resolve, reject) => {
        setTimeout(() => resolve(num -1), 1000); // 6 - 1 = 5
    });
})
.then(num => console.log(num));